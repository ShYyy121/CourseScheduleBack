import{a as h}from"./axios-4a70c6fc.js";import{g as Q}from"./scheduleService-468fdc87.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import{ah as G,R as J,Q as w,as as K,o as n,g as f,a as o,w as r,at as X,i as p,c as y,j as C,f as a,b as W,au as Y,d as N,F as I,h as B,e as S,V as P,v as Z,x as z,t as c}from"./index-1d7bfa1d.js";import{V as D,d as $}from"./VCard-a42e5e86.js";import{V as H}from"./VCheckbox-8dc61ac2.js";const _={name:"teacher",setup(){const s=Y(),e=G({selected:[],selectedScheduleType:"single",classrooms:[],teachingClasses:[],teachingWeek:Array.from({length:16},(t,d)=>`第${d+1}周`),teachingWeekend:["周一","周二","周三","周四","周五","周六","周日"],classPeriods:["第一节","第二节","第三节","第四节","第五节","第六节","第七节","第八节","第九节","第十节"],classroomCourses:null,classlength:0,selectedClassroom:"",selectedClassroomObj:null,selectedTeachingClass:"",selectedTeachingClassBatch:"",startWeek:"",endWeek:"",backendBaseUrl:"",tableHeaders:["星期","课时","课程"],courseSchedule:[],selectedWeek:"",selectedWeekDay:"",selectedPeriod:"",selectedTeacher:"",isDataLoaded:!1,ClassisDataLoaded:!1,classes:[],pagination:[],currentUser:""}),b=async()=>{try{const d=(await Q(e.selectedClassroom))._embedded.schedule.map(async m=>{const F=m._links.self.href.split("/").pop(),U=await h.get(m._links.teachingClass.href.replace("8080","3000")),L=await h.get(U.data._links.course.href.replace("8080","3000")),j=await h.get(U.data._links.teacher.href.replace("8080","3000")),R=L.data.courseName,A=L.data.labHours,M=j.data.teacherName,O=U.data.studentCount;return{classId:F,courseName:R,studentCount:O,labHours:A,teacherName:M}}),i=await Promise.all(d);e.classroomCourses=i,e.isDataLoaded=!0,console.log(e.classroomCourses)}catch(t){console.error(t)}},T=async()=>{await v(),await k(),await b(),await g()},g=async()=>{try{const i=(await h.get(`${e.backendBaseUrl}/api/classes/search/findByTeacher?id=${e.currentUser}`)).data.map(async V=>({classId:V.classId,studentCount:V.studentCount,labHours:V.course.labHours,teacherName:V.teacher.teacherName,courseName:V.course.courseName})),m=await Promise.all(i);e.classes=m,console.log(e.classes),e.ClassisDataLoaded=!0}catch(t){console.error(t)}},v=async()=>{try{const t=await h.get(`${e.backendBaseUrl}/api/classroom`);e.classrooms=t.data._embedded.classroom.map(d=>{const m=d._links.self.href.split("/").pop();return{title:d.classroomName,value:parseInt(m)}}),console.log("classrooms:",e.classrooms)}catch(t){console.error(t)}},l=async()=>{try{const t=await h.get("/api/user");e.currentUser=t.data.id}catch(t){console.error("Error:",t)}},k=async()=>{try{const t=await h.get(`${e.backendBaseUrl}/api/class`);e.teachingClasses=t.data._embedded.class.map(d=>{const m=d._links.self.href.split("/").pop();return{value:parseInt(m),title:d.className}}),console.log("class:",e.classrooms)}catch(t){console.error(t)}},E=()=>{let t;e.selectedScheduleType==="single"?t=`${e.selectedWeek}-${e.selectedWeek}`:e.selectedScheduleType==="batch"&&(t=`${e.startWeek}-${e.endWeek}`);const d={teachingClass:{classId:e.selectedTeachingClass},classroom:{classroomId:e.selectedClassroom},week:t,weekday:e.selectedWeekDay,period:e.selectedPeriod};h.post(`${e.backendBaseUrl}/api/preschedules`,d).then(i=>{alert("保存成功")}).catch(i=>{console.error(i)})};return J(async()=>{await v(),await k(),await l()}),w(()=>e.selectedClassroom,async()=>{await b()}),w(()=>e.selectedTeachingClass,async()=>{await g()}),w(()=>e.selectedScheduleType,async(t,d)=>{await T()}),w(()=>e.selectedTeachingClassBatch,async()=>{await g()}),{...K(e),fetchclass:g,fetchCurrentUser:l,fetchClassroomCourses:b,saveSchedule:E,emits:s}}},u=s=>(Z("data-v-349384a7"),s=s(),z(),s),x={class:"schedule-management-container"},ee=u(()=>a("h1",{class:"text-center"},"排课管理",-1)),se=u(()=>a("h2",{class:"text-center"},"选择排课类型",-1)),le=u(()=>a("h2",null,"实验室课程列表",-1)),ae=u(()=>a("thead",null,[a("tr",null,[a("th",{class:"text-left"}," 课程名 "),a("th",{class:"text-left"}," 学生数量 "),a("th",{class:"text-left"}," 实验学时 "),a("th",{class:"text-left"}," 授课教师 ")])],-1)),te=u(()=>a("h2",null,"单次排课",-1)),oe=u(()=>a("h2",{class:"text-center"},"选择课程",-1)),de=u(()=>a("thead",null,[a("tr",null,[a("th",{class:"text-left"}," 选择 "),a("th",{class:"text-left"}," 学生人数 "),a("th",{class:"text-left"}," 课程名 "),a("th",{class:"text-left"}," 实验学时 "),a("th",{class:"text-left"}," 授课教师 ")])],-1)),ne=u(()=>a("h2",null,"批量排课",-1)),re=u(()=>a("h2",{class:"text-center"},"选择课程",-1)),ce=u(()=>a("thead",null,[a("tr",null,[a("th",{class:"text-left"}," 选择 "),a("th",{class:"text-left"}," 学生人数 "),a("th",{class:"text-left"}," 课程名 "),a("th",{class:"text-left"}," 实验学时 "),a("th",{class:"text-left"}," 授课教师 ")])],-1)),ue={class:"text-center"};function ie(s,e,b,T,g,v){return n(),f("div",x,[ee,se,o(X,{modelValue:s.selectedScheduleType,"onUpdate:modelValue":e[0]||(e[0]=l=>s.selectedScheduleType=l),class:"text-center"},{default:r(()=>[o(W,{value:"single"},{default:r(()=>[N("单次")]),_:1}),o(W,{value:"batch"},{default:r(()=>[N("批量")]),_:1})]),_:1},8,["modelValue"]),o(p,{label:"实验室名称",density:"comfortable",modelValue:s.selectedClassroom,"onUpdate:modelValue":e[1]||(e[1]=l=>s.selectedClassroom=l),items:s.classrooms},null,8,["modelValue","items"]),s.classroomCourses!==null&&s.isDataLoaded?(n(),y(D,{key:0},{default:r(()=>[le,o(S,null,{default:r(()=>[ae,a("tbody",null,[(n(!0),f(I,null,B(s.classroomCourses,l=>(n(),f("tr",{key:l.classId},[a("td",null,c(l.courseName),1),a("td",null,c(l.studentCount),1),a("td",null,c(l.labHours),1),a("td",null,c(l.teacherName),1)]))),128))])]),_:1})]),_:1})):C("",!0),s.selectedScheduleType==="single"?(n(),y($,{key:1},{default:r(()=>[o(D,null,{default:r(()=>[te,o(p,{modelValue:s.selectedTeachingClass,"onUpdate:modelValue":e[2]||(e[2]=l=>s.selectedTeachingClass=l),items:s.teachingClasses,label:"教学班"},null,8,["modelValue","items"]),o(p,{modelValue:s.selectedWeek,"onUpdate:modelValue":e[3]||(e[3]=l=>s.selectedWeek=l),items:s.teachingWeek,"item-text":"name","item-value":"id",label:"周次"},null,8,["modelValue","items"]),o(p,{modelValue:s.selectedWeekDay,"onUpdate:modelValue":e[4]||(e[4]=l=>s.selectedWeekDay=l),items:s.teachingWeekend,"item-text":"name","item-value":"id",label:"日次"},null,8,["modelValue","items"]),o(p,{modelValue:s.selectedPeriod,"onUpdate:modelValue":e[5]||(e[5]=l=>s.selectedPeriod=l),items:s.classPeriods,"item-text":"name","item-value":"id",label:"课次"},null,8,["modelValue","items"]),oe,s.selectedTeachingClass!==""&&s.ClassisDataLoaded?(n(),y(S,{key:0,modelValue:s.selected,"onUpdate:modelValue":e[7]||(e[7]=l=>s.selected=l),headers:s.headers,items:s.classes,"item-key":"classId",pagination:s.pagination},{default:r(()=>[de,a("tbody",null,[(n(!0),f(I,null,B(s.classes,l=>(n(),f("tr",{key:l.classId},[a("td",null,[o(H,{modelValue:s.selected,"onUpdate:modelValue":e[6]||(e[6]=k=>s.selected=k),value:l.classId,"hide-details":""},null,8,["modelValue","value"])]),a("td",null,c(l.studentCount),1),a("td",null,c(l.courseName),1),a("td",null,c(l.labHours),1),a("td",null,c(l.teacherName),1)]))),128))])]),_:1},8,["modelValue","headers","items","pagination"])):C("",!0)]),_:1})]),_:1})):C("",!0),s.selectedScheduleType==="batch"?(n(),y($,{key:2},{default:r(()=>[o(D,null,{default:r(()=>[ne,o(p,{modelValue:s.selectedTeachingClassBatch,"onUpdate:modelValue":e[8]||(e[8]=l=>s.selectedTeachingClassBatch=l),items:s.teachingClasses,"item-text":"name","item-value":"id",label:"教学班"},null,8,["modelValue","items"]),o(P,{modelValue:s.startWeek,"onUpdate:modelValue":e[9]||(e[9]=l=>s.startWeek=l),label:"起始周数"},null,8,["modelValue"]),o(P,{modelValue:s.endWeek,"onUpdate:modelValue":e[10]||(e[10]=l=>s.endWeek=l),label:"结束周数"},null,8,["modelValue"]),o(p,{modelValue:s.selectedWeekDay,"onUpdate:modelValue":e[11]||(e[11]=l=>s.selectedWeekDay=l),items:s.teachingWeekend,"item-text":"name","item-value":"id",label:"日次"},null,8,["modelValue","items"]),o(p,{modelValue:s.selectedPeriod,"onUpdate:modelValue":e[12]||(e[12]=l=>s.selectedPeriod=l),items:s.classPeriods,"item-text":"name","item-value":"id",label:"课次"},null,8,["modelValue","items"]),re,s.selectedTeachingClass!==""||s.selectedTeachingClassBatch!==""&&s.ClassisDataLoaded?(n(),y(S,{key:0,modelValue:s.selected,"onUpdate:modelValue":e[14]||(e[14]=l=>s.selected=l),headers:s.headers,items:s.classes,"item-key":"classId",pagination:s.pagination},{default:r(()=>[ce,a("tbody",null,[(n(!0),f(I,null,B(s.classes,l=>(n(),f("tr",{key:l.classId},[a("td",null,[o(H,{modelValue:s.selected,"onUpdate:modelValue":e[13]||(e[13]=k=>s.selected=k),value:l.classId,"hide-details":""},null,8,["modelValue","value"])]),a("td",null,c(l.studentCount),1),a("td",null,c(l.courseName),1),a("td",null,c(l.labHours),1),a("td",null,c(l.teacherName),1)]))),128))])]),_:1},8,["modelValue","headers","items","pagination"])):C("",!0)]),_:1})]),_:1})):C("",!0),a("div",ue,[o(W,{color:"primary",onClick:T.saveSchedule},{default:r(()=>[N("保存")]),_:1},8,["onClick"])])])}const ge=q(_,[["render",ie],["__scopeId","data-v-349384a7"]]);export{ge as default};
