import C from"./Navbar-c07d5b63.js";import{a as m}from"./axios-4a70c6fc.js";import{_ as v}from"./_plugin-vue_export-helper-c27b6911.js";import{V as B}from"./VApp-10a77899.js";import{V,a as h}from"./VRow-c57088bb.js";import{V as N,a as U,b as I,c as T,d as D}from"./VCard-a42e5e86.js";import{o as f,c as k,w as a,a as e,V as g,b as _,d as c,e as L,f as d,g as y,h as J,F as A,t as p,i as P,j as b,k as w}from"./index-1d7bfa1d.js";import{V as S}from"./VSpacer-c435019f.js";import{V as j}from"./VDialog-ed4e416b.js";import"./VMain-829b4bfa.js";const q={name:"UserInfoInsert",components:{Navbar:C},data(){return{search:"",dialogVisible:!1,dialogTitle:"",identity:"",name:"",adminName:"",teacherName:"",adminId:"",teacherId:"",backendBaseUrl:"",teachers:[],admins:[],loaded:!1,loading:!1,mergedUsers:[],password:"",identityOptions:["管理员","教师"],users:[{identity:"Administrator",name:"John Doe",adminName:"John",teacherName:"",adminId:1,teacherId:null},{identity:"Teacher",name:"Jane Smith",adminName:"",teacherName:"Jane",adminId:null,teacherId:2}],defaultUsers:[{identity:"Administrator",name:"John Doe",adminName:"John",teacherName:"",adminId:1,teacherId:null},{identity:"Teacher",name:"Jane Smith",adminName:"",teacherName:"Jane",adminId:null,teacherId:2}],headers:[{text:"身份",value:"identity"},{text:"名字",value:"name"},{text:"管理员名称 / 教师名称",value:"adminTeacherName"},{text:"管理员ID",value:"adminId"},{text:"教师ID",value:"teacherId"},{text:"操作",value:"actions"}]}},computed:{filteredUsers(){return this.search===""?this.users:this.mergedUsers.filter(s=>s.username.toLowerCase().includes(this.search.toLowerCase()))}},mounted(){this.fetchUsers("")},methods:{editUser(s){this.dialogTitle="编辑",this.identity=s.identity,this.name=s.name,this.adminName=s.adminName,this.teacherName=s.teacherName,this.adminId=s.adminId,this.teacherId=s.teacherId,this.dialogVisible=!0},deleteUser(s,t){t==="管理员"?m.delete(`${this.backendBaseUrl}/api/administrator/${s}`).then(n=>{console.log(n),this.fetchUsers()}).catch(n=>{console.error(n)}):m.delete(`${this.backendBaseUrl}/api/teacher/${s}`).then(n=>{console.log(n),this.fetchUsers()}).catch(n=>{alert("请先删除授课教师的课程"),console.error(n)})},async fetchUsers(s){this.loading=!0;let t,n;if(this.search==="")t=await m.get(`${this.backendBaseUrl}/api/teacher?page=0&size=10&sort=className,asc`),n=await m.get(`${this.backendBaseUrl}/api/administrator?page=0&size=10&sort=className,asc`),this.teachers=t.data._embedded.teacher.map(r=>({id:r._links.self.href.split("/").pop(),username:r.teacherName,password:r.teacherPassword,role:"教师"})),this.admins=n.data._embedded.administrator.map(r=>({id:r._links.self.href.split("/").pop(),username:r.adminName,password:r.adminPassword,role:"管理员"}));else{this.teachers=[],this.admins=[],t=await m.get(`${this.backendBaseUrl}/api/teacher/search/findByTeacherName?teacherName=${s}`),n=await m.get(`${this.backendBaseUrl}/api/administrator/search/findByAdminName?adminName=${s}`);const r=t.data,i={id:r._links.self.href.split("/").pop(),username:r.teacherName,password:r.teacherPassword,role:"教师"};this.teachers.push(i);const u=n.data,x={id:u._links.self.href.split("/").pop(),username:u.adminName,password:u.adminPassword,role:"管理员"};this.admins.push(x)}this.mergedUsers=[...this.teachers,...this.admins],this.loading=!1,this.loaded=!0},openDialog(s){this.dialogTitle=s,this.identity="",this.name="",this.adminName="",this.teacherName="",this.adminId="",this.teacherId="",this.dialogVisible=!0},saveUser(){if(this.identity===""||this.name===""){alert("请填写完整");return}if(this.identity==="管理员"){let s={adminName:this.name,adminPassword:this.password};m.post(`${this.backendBaseUrl}/api/administrator`,s).then(t=>{alert("保存成功")})}else if(this.identity==="教师"){let s={teacherName:this.name,teacherPassword:this.password};m.post(`${this.backendBaseUrl}/api/teacher`,s).then(t=>{alert("保存成功")})}if(this.dialogTitle==="编辑"){const s=this.users.findIndex(t=>t.name===user.name);s!==-1&&this.users.splice(s,1,user)}else this.users.push(user);this.identity="",this.name="",this.adminName="",this.teacherName="",this.adminId="",this.teacherId="",this.dialogVisible=!1},closeDialog(){this.dialogVisible=!1}}},O=d("h1",null,"用户信息",-1),F=d("h3",null,"用户列表",-1),R=d("thead",null,[d("tr",null,[d("th",{class:"text-left"}," ID "),d("th",{class:"text-left"}," 用户名 "),d("th",{class:"text-left"}," 密码 "),d("th",{class:"text-left"}," 角色 ")])],-1);function z(s,t,n,r,l,o){return f(),k(B,null,{default:a(()=>[e(D,null,{default:a(()=>[O,e(V,{class:"mt-4"},{default:a(()=>[e(h,{cols:"12",sm:"6",md:"4",class:"d-flex justify-start"})]),_:1}),e(N,null,{default:a(()=>[e(U,null,{default:a(()=>[e(V,null,{default:a(()=>[e(h,{cols:"8"},{default:a(()=>[F]),_:1}),e(h,{cols:"6",class:"text-left"},{default:a(()=>[e(I,null,{default:a(()=>[e(g,{loading:l.loading,density:"compact",variant:"solo",label:"输入用户名","append-inner-icon":"mdi-magnify",modelValue:this.search,"onUpdate:modelValue":t[0]||(t[0]=i=>this.search=i),"single-line":"","hide-details":"","onClick:appendInner":t[1]||(t[1]=i=>o.fetchUsers(this.search))},null,8,["loading","modelValue"])]),_:1})]),_:1})]),_:1}),e(h,{cols:"6",class:"text-left"},{default:a(()=>[e(S),e(_,{color:"primary",onClick:t[2]||(t[2]=i=>o.openDialog("添加用户"))},{default:a(()=>[c("添加用户")]),_:1})]),_:1})]),_:1}),e(I,null,{default:a(()=>[e(L,null,{default:a(()=>[R,d("tbody",null,[(f(!0),y(A,null,J(l.mergedUsers,i=>(f(),y("tr",{key:i.id},[d("td",null,p(i.id),1),d("td",null,p(i.username),1),d("td",null,p(i.password),1),d("td",null,p(i.role),1),e(w,{onClick:u=>o.editUser(i),class:"mr-2"},{default:a(()=>[c("mdi-pencil")]),_:2},1032,["onClick"]),e(w,{onClick:u=>o.deleteUser(i.id,i.role)},{default:a(()=>[c("mdi-delete")]),_:2},1032,["onClick"])]))),128))])]),_:1})]),_:1})]),_:1}),e(j,{modelValue:l.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=i=>l.dialogVisible=i),"max-width":"500px"},{default:a(()=>[e(N,null,{default:a(()=>[e(U,null,{default:a(()=>[c(p(l.dialogTitle),1)]),_:1}),e(I,null,{default:a(()=>[e(P,{modelValue:l.identity,"onUpdate:modelValue":t[3]||(t[3]=i=>l.identity=i),items:l.identityOptions,label:"身份",required:""},null,8,["modelValue","items"]),e(g,{modelValue:l.name,"onUpdate:modelValue":t[4]||(t[4]=i=>l.name=i),label:"名字",required:""},null,8,["modelValue"]),l.identity==="管理员"?(f(),k(V,{key:0},{default:a(()=>[e(h,{cols:"12"},{default:a(()=>[e(g,{modelValue:l.password,"onUpdate:modelValue":t[5]||(t[5]=i=>l.password=i),label:"密码",required:""},null,8,["modelValue"])]),_:1})]),_:1})):b("",!0),l.identity==="教师"?(f(),k(V,{key:1},{default:a(()=>[e(h,{cols:"12"},{default:a(()=>[e(g,{modelValue:l.password,"onUpdate:modelValue":t[6]||(t[6]=i=>l.password=i),label:"密码",required:""},null,8,["modelValue"])]),_:1})]),_:1})):b("",!0)]),_:1}),e(T,null,{default:a(()=>[e(_,{color:"primary",onClick:o.saveUser},{default:a(()=>[c("保存")]),_:1},8,["onClick"]),e(_,{color:"error",onClick:o.closeDialog},{default:a(()=>[c("取消")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const te=v(q,[["render",z]]);export{te as default};
