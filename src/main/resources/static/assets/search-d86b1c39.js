import{a as _}from"./axios-4a70c6fc.js";import{g as L}from"./scheduleService-468fdc87.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";import{V as v,d as P}from"./VCard-a42e5e86.js";import{p as U,m as R,av as W,n as E,aw as A,P as j,s as q,a as c,ax as z,r as D,o as i,g as k,w as o,c as b,j as V,at as G,b as w,d as N,i as T,e as S,f as s,F as I,h as F,t as d,v as J,x as K}from"./index-1d7bfa1d.js";const M=U({...R(),...W()},"VForm"),x=E()({name:"VForm",props:M(),emits:{"update:modelValue":a=>!0,submit:a=>!0},setup(a,l){let{slots:m,emit:f}=l;const t=A(a),u=j();function r(e){e.preventDefault(),t.reset()}function p(e){const h=e,n=t.validate();h.then=n.then.bind(n),h.catch=n.catch.bind(n),h.finally=n.finally.bind(n),f("submit",h),h.defaultPrevented||n.then(g=>{var B;let{valid:y}=g;y&&((B=u.value)==null||B.submit())}),h.preventDefault()}return q(()=>{var e;return c("form",{ref:u,class:["v-form",a.class],style:a.style,novalidate:!0,onReset:r,onSubmit:p},[(e=m.default)==null?void 0:e.call(m,t)])}),z(t,u)}}),O={name:"Search",data(){return{selectedCategory:null,teachers:[],selectedTeacher:"",selectedTeachingClass:"",selectedWeek:null,scheduleData:[],teachingClasses:[],backendBaseUrl:"",tableHeaders:["教师","课程","实验室"],classroomCourses:[],isDataLoaded:!1}},watch:{selectedCategory(){this.selectedTeacher="",this.selectedTeachingClass="",this.selectedWeek=null}},mounted(){this.fetchteachingClasses(),this.fetchteacher()},methods:{fetchScheduleData(){this.selectedCategory==="teacher"?(console.log("按教师查询，教师ID:",this.selectedTeacher),this.scheduleData=[{teacher:"教师A",course:"课程A",classroom:"实验室A"},{teacher:"教师B",course:"课程B",classroom:"实验室B"}]):this.selectedCategory==="teachingClass"?(console.log("按教学班查询，教学班ID:",this.selectedTeachingClass),this.scheduleData=[{teacher:"教师C",course:"课程C",classroom:"实验室C"},{teacher:"教师D",course:"课程D",classroom:"实验室D"}]):this.selectedCategory==="weeklySchedule"&&(console.log("每周课表查询，选择的周:",this.selectedWeek),this.scheduleData=[{teacher:"教师E",course:"课程E",classroom:"实验室E"},{teacher:"教师F",course:"课程F",classroom:"实验室F"}])},async fetchteachingClasses(){try{const a=await _.get(`${this.backendBaseUrl}/api/class`);this.teachingClasses=a.data._embedded.class.map(l=>l.className)}catch(a){console.error(a)}},async fetchteacher(){try{const a=await _.get(`${this.backendBaseUrl}/api/teacher`);this.teachers=a.data._embedded.teacher.map(l=>({value:l._links.self.href.split("/").pop(),title:l.teacherName}))}catch(a){console.error(a)}},async fetchScheduleByTeacher(){const l=(await _.get(`/api/schedule/search/findByTeacher?id=${this.selectedTeacher}`)).data._embedded.schedule.map(async f=>{const u=f._links.self.href.split("/").pop(),r=await _.get(f._links.teachingClass.href.replace("8080","3000")),p=await _.get(r.data._links.course.href.replace("8080","3000")),e=await _.get(r.data._links.teacher.href.replace("8080","3000")),h=p.data.courseName,n=p.data.labHours,g=e.data.teacherName,y=r.data.studentCount;return{classId:u,courseName:h,studentCount:y,labHours:n,teacherName:g}}),m=await Promise.all(l);this.classroomCourses=m,this.isDataLoaded=!0},async fetchScheduleByClass(){const l=(await L(this.selectedTeachingClass))._embedded.schedule.map(async f=>{const u=f._links.self.href.split("/").pop(),r=await _.get(f._links.teachingClass.href.replace("8080","3000")),p=await _.get(r.data._links.course.href.replace("8080","3000")),e=await _.get(r.data._links.teacher.href.replace("8080","3000")),h=p.data.courseName,n=p.data.labHours,g=e.data.teacherName,y=r.data.studentCount;return{classId:u,courseName:h,studentCount:y,labHours:n,teacherName:g}}),m=await Promise.all(l);this.classroomCourses=m,this.isDataLoaded=!0,console.log(this.classroomCourses)}}},C=a=>(J("data-v-123e5e72"),a=a(),K(),a),Q={class:"text-center"},X=C(()=>s("h1",{style:{width:"200px"}},"查询",-1)),Y=C(()=>s("h2",null,"查询类别",-1)),Z=C(()=>s("thead",null,[s("tr",null,[s("th",{class:"text-left"}," 课程名 "),s("th",{class:"text-left"}," 学生数量 "),s("th",{class:"text-left"}," 实验学时 "),s("th",{class:"text-left"}," 授课教师 ")])],-1)),$=C(()=>s("h2",null,"实验室课程列表",-1)),ee=C(()=>s("thead",null,[s("tr",null,[s("th",{class:"text-left"}," 课程名 "),s("th",{class:"text-left"}," 学生数量 "),s("th",{class:"text-left"}," 实验学时 "),s("th",{class:"text-left"}," 授课教师 ")])],-1)),se=C(()=>s("h2",null,"排课信息",-1));function te(a,l,m,f,t,u){const r=D("v-date-picker"),p=D("v-data-table");return i(),k("div",Q,[X,c(v,{style:{"max-width":"400px",margin:"0 auto"}},{default:o(()=>[Y,c(G,{modelValue:t.selectedCategory,"onUpdate:modelValue":l[0]||(l[0]=e=>t.selectedCategory=e),class:"text-center"},{default:o(()=>[c(w,{value:"teacher"},{default:o(()=>[N("按教师查询")]),_:1}),c(w,{value:"teachingClass"},{default:o(()=>[N("按教学班查询")]),_:1}),c(w,{value:"weeklySchedule"},{default:o(()=>[N("每周课表查询")]),_:1})]),_:1},8,["modelValue"])]),_:1}),c(P,null,{default:o(()=>[t.selectedCategory==="teacher"?(i(),b(x,{key:0},{default:o(()=>[c(T,{modelValue:t.selectedTeacher,"onUpdate:modelValue":l[1]||(l[1]=e=>t.selectedTeacher=e),"update:modelValue":u.fetchScheduleByTeacher(),items:t.teachers,label:"教师"},null,8,["modelValue","update:modelValue","items"]),c(S,null,{default:o(()=>[Z,s("tbody",null,[(i(!0),k(I,null,F(t.classroomCourses,e=>(i(),k("tr",{key:e.classId},[s("td",null,d(e.courseName),1),s("td",null,d(e.studentCount),1),s("td",null,d(e.labHours),1),s("td",null,d(e.teacherName),1)]))),128))])]),_:1})]),_:1})):V("",!0),t.selectedCategory==="teachingClass"?(i(),b(x,{key:1},{default:o(()=>[c(T,{modelValue:t.selectedTeachingClass,"onUpdate:modelValue":l[2]||(l[2]=e=>t.selectedTeachingClass=e),"update:modelValue":u.fetchScheduleByClass(),items:t.teachingClasses,"item-text":"name","item-value":"id",label:"教学班"},null,8,["modelValue","update:modelValue","items"]),t.classroomCourses!==[]&&t.isDataLoaded?(i(),b(v,{key:0},{default:o(()=>[$,c(S,null,{default:o(()=>[ee,s("tbody",null,[(i(!0),k(I,null,F(t.classroomCourses,e=>(i(),k("tr",{key:e.classId},[s("td",null,d(e.courseName),1),s("td",null,d(e.studentCount),1),s("td",null,d(e.labHours),1),s("td",null,d(e.teacherName),1)]))),128))])]),_:1})]),_:1})):V("",!0)]),_:1})):V("",!0),t.selectedCategory==="weeklySchedule"?(i(),b(x,{key:2},{default:o(()=>[c(r,{modelValue:t.selectedWeek,"onUpdate:modelValue":l[3]||(l[3]=e=>t.selectedWeek=e),label:"选择周",dense:""},null,8,["modelValue"])]),_:1})):V("",!0)]),_:1}),t.scheduleData.length>0?(i(),b(v,{key:0},{default:o(()=>[se,c(p,{headers:t.tableHeaders,items:t.scheduleData,"rows-per-page-items":[10,25,50]},{item:o(({item:e})=>[s("tr",null,[s("td",null,d(e.teacher),1),s("td",null,d(e.course),1),s("td",null,d(e.classroom),1)])]),_:1},8,["headers","items"])]),_:1})):V("",!0)])}const ne=H(O,[["render",te],["__scopeId","data-v-123e5e72"]]);export{ne as default};
