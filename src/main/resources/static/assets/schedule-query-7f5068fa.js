import{a as S}from"./axios-4a70c6fc.js";import{g as oe}from"./scheduleService-468fdc87.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";import{P as re,ak as ue,p as de,al as _,z as ce,m as me,am as fe,A as ve,B as ge,an as he,y as pe,l as be,ao as ye,n as Ve,U as ke,ap as Ce,u as Le,q as Pe,a0 as Se,I as we,K as x,ai as Ie,J as W,D,s as Te,a as s,b as V,Y as M,aq as q,ar as ee,a4 as ae,ah as Ne,R as Be,Q as K,as as De,o as p,g as U,w as m,at as Ue,i as T,c as E,j as z,f as t,au as We,d as N,F as X,h as Y,e as Z,V as le,v as Ae,x as Re,t as b}from"./index-1d7bfa1d.js";import{V as j,d as te,a as $e,b as Fe,c as He}from"./VCard-a42e5e86.js";import{V as Me}from"./VDialog-ed4e416b.js";import{V as se}from"./VCheckbox-8dc61ac2.js";function Ee(){const e=re([]);ue(()=>e.value=[]);function a(v,k){e.value[k]=v}return{refs:e,updateRef:a}}const ze=de({activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:e=>e.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:e=>e%1===0},totalVisible:[Number,String],firstIcon:{type:_,default:"$first"},prevIcon:{type:_,default:"$prev"},nextIcon:{type:_,default:"$next"},lastIcon:{type:_,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...ce(),...me(),...fe(),...ve(),...ge(),...he(),...pe({tag:"nav"}),...be(),...ye({variant:"text"})},"VPagination"),ne=Ve()({name:"VPagination",props:ze(),emits:{"update:modelValue":e=>!0,first:e=>!0,prev:e=>!0,next:e=>!0,last:e=>!0},setup(e,a){let{slots:v,emit:k}=a;const r=ke(e,"modelValue"),{t:C,n:l}=Ce(),{isRtl:L}=Le(),{themeClasses:O}=Pe(e),{width:G}=Se(),A=we(-1);x(void 0,{scoped:!0});const{resizeRef:i}=Ie(n=>{if(!n.length)return;const{target:d,contentRect:f}=n[0],h=d.querySelector(".v-pagination__list > *");if(!h)return;const P=f.width,H=h.offsetWidth+parseFloat(getComputedStyle(h).marginRight)*2;A.value=I(P,H)}),o=W(()=>parseInt(e.length,10)),u=W(()=>parseInt(e.start,10)),c=W(()=>e.totalVisible?parseInt(e.totalVisible,10):A.value>=0?A.value:I(G.value,58));function I(n,d){const f=e.showFirstLastPage?5:3;return Math.max(0,Math.floor(+((n-d*f)/d).toFixed(2)))}const R=W(()=>{if(o.value<=0||isNaN(o.value)||o.value>Number.MAX_SAFE_INTEGER)return[];if(c.value<=1)return[r.value];if(o.value<=c.value)return q(o.value,u.value);const n=c.value%2===0,d=n?c.value/2:Math.floor(c.value/2),f=n?d:d+1,h=o.value-d;if(f-r.value>=0)return[...q(Math.max(1,c.value-1),u.value),e.ellipsis,o.value];if(r.value-h>=(n?1:0)){const P=c.value-1,H=o.value-P+u.value;return[u.value,e.ellipsis,...q(P,H)]}else{const P=Math.max(1,c.value-3),H=P===1?r.value:r.value-Math.ceil(P/2)+u.value;return[u.value,e.ellipsis,...q(P,H),e.ellipsis,o.value]}});function y(n,d,f){n.preventDefault(),r.value=d,f&&k(f,d)}const{refs:B,updateRef:$}=Ee();x({VPaginationBtn:{color:D(e,"color"),border:D(e,"border"),density:D(e,"density"),size:D(e,"size"),variant:D(e,"variant"),rounded:D(e,"rounded"),elevation:D(e,"elevation")}});const F=W(()=>R.value.map((n,d)=>{const f=h=>$(h,d);if(typeof n=="string")return{isActive:!1,key:`ellipsis-${d}`,page:n,props:{ref:f,ellipsis:!0,icon:!0,disabled:!0}};{const h=n===r.value;return{isActive:h,key:n,page:l(n),props:{ref:f,ellipsis:!1,icon:!0,disabled:!!e.disabled||+e.length<2,color:h?e.activeColor:e.color,ariaCurrent:h,ariaLabel:C(h?e.currentPageAriaLabel:e.pageAriaLabel,n),onClick:P=>y(P,n)}}}})),g=W(()=>{const n=!!e.disabled||r.value<=u.value,d=!!e.disabled||r.value>=u.value+o.value-1;return{first:e.showFirstLastPage?{icon:L.value?e.lastIcon:e.firstIcon,onClick:f=>y(f,u.value,"first"),disabled:n,ariaLabel:C(e.firstAriaLabel),ariaDisabled:n}:void 0,prev:{icon:L.value?e.nextIcon:e.prevIcon,onClick:f=>y(f,r.value-1,"prev"),disabled:n,ariaLabel:C(e.previousAriaLabel),ariaDisabled:n},next:{icon:L.value?e.prevIcon:e.nextIcon,onClick:f=>y(f,r.value+1,"next"),disabled:d,ariaLabel:C(e.nextAriaLabel),ariaDisabled:d},last:e.showFirstLastPage?{icon:L.value?e.firstIcon:e.lastIcon,onClick:f=>y(f,u.value+o.value-1,"last"),disabled:d,ariaLabel:C(e.lastAriaLabel),ariaDisabled:d}:void 0}});function Q(){var d;const n=r.value-u.value;(d=B.value[n])==null||d.$el.focus()}function J(n){n.key===ee.left&&!e.disabled&&r.value>+e.start?(r.value=r.value-1,ae(Q)):n.key===ee.right&&!e.disabled&&r.value<u.value+o.value-1&&(r.value=r.value+1,ae(Q))}return Te(()=>s(e.tag,{ref:i,class:["v-pagination",O.value,e.class],style:e.style,role:"navigation","aria-label":C(e.ariaLabel),onKeydown:J,"data-test":"v-pagination-root"},{default:()=>[s("ul",{class:"v-pagination__list"},[e.showFirstLastPage&&s("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[v.first?v.first(g.value.first):s(V,M({_as:"VPaginationBtn"},g.value.first),null)]),s("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[v.prev?v.prev(g.value.prev):s(V,M({_as:"VPaginationBtn"},g.value.prev),null)]),F.value.map((n,d)=>s("li",{key:n.key,class:["v-pagination__item",{"v-pagination__item--is-active":n.isActive}],"data-test":"v-pagination-item"},[v.item?v.item(n):s(V,M({_as:"VPaginationBtn"},n.props),{default:()=>[n.page]})])),s("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[v.next?v.next(g.value.next):s(V,M({_as:"VPaginationBtn"},g.value.next),null)]),e.showFirstLastPage&&s("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[v.last?v.last(g.value.last):s(V,M({_as:"VPaginationBtn"},g.value.last),null)])])]})),{}}}),Qe={name:"ScheduleQuery",setup(){const e=We(),a=Ne({selected:[],selectedScheduleType:"single",classrooms:[],teachingClasses:[],teachingWeek:Array.from({length:16},(i,o)=>o+1).map(i=>({title:`第${i}周`,value:i})),teachingWeekend:[{value:1,title:"周一"},{value:2,title:"周二"},{value:3,title:"周三"},{value:4,title:"周四"},{value:5,title:"周五"},{value:6,title:"周六"},{value:7,title:"周日"}],classPeriods:[{value:1,title:"第一节"},{value:2,title:"第二节"},{value:3,title:"第三节"},{value:4,title:"第四节"},{value:5,title:"第五节"},{value:6,title:"第六节"},{value:7,title:"第七节"},{value:8,title:"第八节"},{value:9,title:"第九节"},{value:10,title:"第十节"}],classroomCourses:null,classlength:0,selectedClassroom:"",selectedClassroomObj:null,selectedTeachingClass:"",selectedTeachingClassBatch:"",startWeek:"",endWeek:"",backendBaseUrl:"",tableHeaders:["星期","课时","课程"],courseSchedule:[],selectedWeek:null,selectedWeekDay:null,selectedPeriod:null,selectedTeacher:"",isDataLoaded:!1,ClassisDataLoaded:!1,classes:[],pagination:[],dialogVisible:!1}),v=async()=>{try{const o=(await oe(a.selectedClassroom))._embedded.schedule.map(async c=>{const R=c._links.self.href.split("/").pop(),y=await S.get(c._links.teachingClass.href.replace("8080","3000")),B=await S.get(y.data._links.course.href.replace("8080","3000")),$=await S.get(y.data._links.teacher.href.replace("8080","3000")),F=B.data.courseName,g=B.data.labHours,Q=$.data.teacherName,J=y.data.studentCount;return{classId:R,courseName:F,studentCount:J,labHours:g,teacherName:Q}}),u=await Promise.all(o);a.classroomCourses=u,a.isDataLoaded=!0,console.log(a.classroomCourses)}catch(i){console.error(i)}},k=async()=>{await C(),await l(),await v(),await r()},r=async()=>{try{const o=(await S.get(`${a.backendBaseUrl}/api/class?page=0&size=10&sort=className,asc`)).data;a.pagination=o.page;const u=o._embedded.class.map(async I=>{const R=I._links.self.href.split("/").pop(),y=await S.get(I._links.teacher.href.replace("8080","3000")),B=await S.get(I._links.course.href.replace("8080","3000")),$=y.data.teacherName,F=B.data.courseName,g=B.data.labHours;return{classId:R,studentCount:I.studentCount,labHours:g,teacherName:$,courseName:F}}),c=await Promise.all(u);a.classes=c,console.log(a.classes),a.ClassisDataLoaded=!0}catch(i){console.error(i)}},C=async()=>{try{const i=await S.get(`${a.backendBaseUrl}/api/classroom`);a.classrooms=i.data._embedded.classroom.map(o=>{const c=o._links.self.href.split("/").pop();return{title:o.classroomName,value:parseInt(c)}}),console.log("classrooms:",a.classrooms)}catch(i){console.error(i)}},l=async()=>{try{const i=await S.get(`${a.backendBaseUrl}/api/class`);a.teachingClasses=i.data._embedded.class.map(o=>{const c=o._links.self.href.split("/").pop();return{value:parseInt(c),title:o.className}}),console.log("class:",a.classrooms)}catch(i){console.error(i)}},L=()=>{const i={teachingClass:{classId:parseInt(a.selectedTeachingClass)},classroom:{classroomId:a.selectedClassroom},week:null,weekday:a.selectedWeekDay,period:a.selectedPeriod};if(a.selectedScheduleType==="single")i.week=a.selectedWeek,o(i);else if(a.selectedScheduleType==="batch")for(let u=a.startWeek;u<=a.endWeek;u++)i.week=u,o(i);function o(u){S.post(`${a.backendBaseUrl}/api/preschedules`,u).then(c=>{alert("保存成功")}).catch(c=>{console.error(c)})}},O=()=>{a.dialogVisible=!0},G=()=>{S.get("/api/flush").then(()=>{alert("转换成功")}).catch(i=>{alert("有时间冲突"),console.error("Error during synchronization:",i)}).finally(()=>{this.dialogVisible=!1})},A=()=>{this.dialogVisible=!1};return Be(async()=>{await C(),await l()}),K(()=>a.selectedClassroom,async()=>{await v()}),K(()=>a.selectedTeachingClass,async()=>{await r()}),K(()=>a.selectedScheduleType,async(i,o)=>{await k()}),K(()=>a.selectedTeachingClassBatch,async()=>{await r()}),{...De(a),fetchclass:r,fetchClassroomCourses:v,saveSchedule:L,cancelSync:A,syncToSchedule:G,saveRealSchedule:O,emits:e}}},w=e=>(Ae("data-v-e313ffeb"),e=e(),Re(),e),_e={class:"schedule-management-container"},qe=w(()=>t("h1",{class:"text-center"},"排课管理",-1)),Ke=w(()=>t("h2",{class:"text-center"},"选择排课类型",-1)),je=w(()=>t("h2",null,"实验室课程列表",-1)),Oe=w(()=>t("thead",null,[t("tr",null,[t("th",{class:"text-left"}," 课程名 "),t("th",{class:"text-left"}," 学生数量 "),t("th",{class:"text-left"}," 实验学时 "),t("th",{class:"text-left"}," 授课教师 ")])],-1)),Ge=w(()=>t("h2",null,"单次排课",-1)),Je=w(()=>t("h2",{class:"text-center"},"选择课程",-1)),Xe=w(()=>t("thead",null,[t("tr",null,[t("th",{class:"text-left"}," 选择 "),t("th",{class:"text-left"}," 学生人数 "),t("th",{class:"text-left"}," 课程名 "),t("th",{class:"text-left"}," 实验学时 "),t("th",{class:"text-left"}," 授课教师 ")])],-1)),Ye=w(()=>t("h2",null,"批量排课",-1)),Ze=w(()=>t("h2",{class:"text-center"},"选择课程",-1)),xe=w(()=>t("thead",null,[t("tr",null,[t("th",{class:"text-left"}," 选择 "),t("th",{class:"text-left"}," 学生人数 "),t("th",{class:"text-left"}," 课程名 "),t("th",{class:"text-left"}," 实验学时 "),t("th",{class:"text-left"}," 授课教师 ")])],-1)),ea={class:"text-center"},aa={class:"text-center mt-4"};function la(e,a,v,k,r,C){return p(),U("div",_e,[qe,Ke,s(Ue,{modelValue:e.selectedScheduleType,"onUpdate:modelValue":a[0]||(a[0]=l=>e.selectedScheduleType=l),class:"text-center"},{default:m(()=>[s(V,{value:"single"},{default:m(()=>[N("单次")]),_:1}),s(V,{value:"batch"},{default:m(()=>[N("批量")]),_:1})]),_:1},8,["modelValue"]),s(T,{label:"实验室名称",density:"comfortable",modelValue:e.selectedClassroom,"onUpdate:modelValue":a[1]||(a[1]=l=>e.selectedClassroom=l),items:e.classrooms},null,8,["modelValue","items"]),e.classroomCourses!==null&&e.isDataLoaded?(p(),E(j,{key:0},{default:m(()=>[je,s(Z,null,{default:m(()=>[Oe,t("tbody",null,[(p(!0),U(X,null,Y(e.classroomCourses,l=>(p(),U("tr",{key:l.classId},[t("td",null,b(l.courseName),1),t("td",null,b(l.studentCount),1),t("td",null,b(l.labHours),1),t("td",null,b(l.teacherName),1)]))),128))])]),_:1})]),_:1})):z("",!0),e.selectedScheduleType==="single"?(p(),E(te,{key:1},{default:m(()=>[s(j,null,{default:m(()=>[Ge,s(T,{modelValue:e.selectedTeachingClass,"onUpdate:modelValue":a[2]||(a[2]=l=>e.selectedTeachingClass=l),items:e.teachingClasses,label:"教学班"},null,8,["modelValue","items"]),s(T,{modelValue:e.selectedWeek,"onUpdate:modelValue":a[3]||(a[3]=l=>e.selectedWeek=l),items:e.teachingWeek,label:"周次"},null,8,["modelValue","items"]),s(T,{modelValue:e.selectedWeekDay,"onUpdate:modelValue":a[4]||(a[4]=l=>e.selectedWeekDay=l),items:e.teachingWeekend,label:"日次"},null,8,["modelValue","items"]),s(T,{modelValue:e.selectedPeriod,"onUpdate:modelValue":a[5]||(a[5]=l=>e.selectedPeriod=l),items:e.classPeriods,label:"课次"},null,8,["modelValue","items"]),Je,e.selectedTeachingClass!==""&&e.ClassisDataLoaded?(p(),E(Z,{key:0,modelValue:e.selected,"onUpdate:modelValue":a[8]||(a[8]=l=>e.selected=l),headers:e.headers,items:e.classes,"item-key":"classId",pagination:e.pagination},{default:m(()=>[Xe,t("tbody",null,[(p(!0),U(X,null,Y(e.classes,l=>(p(),U("tr",{key:l.classId},[t("td",null,[s(se,{modelValue:e.selected,"onUpdate:modelValue":a[6]||(a[6]=L=>e.selected=L),value:l.classId,"hide-details":""},null,8,["modelValue","value"])]),t("td",null,b(l.studentCount),1),t("td",null,b(l.courseName),1),t("td",null,b(l.labHours),1),t("td",null,b(l.teacherName),1)]))),128))]),s(ne,{modelValue:e.pagination.number,"onUpdate:modelValue":a[7]||(a[7]=l=>e.pagination.number=l),length:e.pagination.totalPages,slot:"top"},null,8,["modelValue","length"])]),_:1},8,["modelValue","headers","items","pagination"])):z("",!0)]),_:1})]),_:1})):z("",!0),e.selectedScheduleType==="batch"?(p(),E(te,{key:2},{default:m(()=>[s(j,null,{default:m(()=>[Ye,s(T,{modelValue:e.selectedTeachingClass,"onUpdate:modelValue":a[9]||(a[9]=l=>e.selectedTeachingClass=l),items:e.teachingClasses,label:"教学班"},null,8,["modelValue","items"]),s(le,{modelValue:e.startWeek,"onUpdate:modelValue":a[10]||(a[10]=l=>e.startWeek=l),label:"起始周数"},null,8,["modelValue"]),s(le,{modelValue:e.endWeek,"onUpdate:modelValue":a[11]||(a[11]=l=>e.endWeek=l),label:"结束周数"},null,8,["modelValue"]),s(T,{modelValue:e.selectedWeekDay,"onUpdate:modelValue":a[12]||(a[12]=l=>e.selectedWeekDay=l),items:e.teachingWeekend,label:"日次"},null,8,["modelValue","items"]),s(T,{modelValue:e.selectedPeriod,"onUpdate:modelValue":a[13]||(a[13]=l=>e.selectedPeriod=l),items:e.classPeriods,label:"课次"},null,8,["modelValue","items"]),Ze,e.selectedTeachingClass!==""||e.selectedTeachingClassBatch!==""&&e.ClassisDataLoaded?(p(),E(Z,{key:0,modelValue:e.selected,"onUpdate:modelValue":a[16]||(a[16]=l=>e.selected=l),headers:e.headers,items:e.classes,"item-key":"classId",pagination:e.pagination},{default:m(()=>[xe,t("tbody",null,[(p(!0),U(X,null,Y(e.classes,l=>(p(),U("tr",{key:l.classId},[t("td",null,[s(se,{modelValue:e.selected,"onUpdate:modelValue":a[14]||(a[14]=L=>e.selected=L),value:l.classId,"hide-details":""},null,8,["modelValue","value"])]),t("td",null,b(l.studentCount),1),t("td",null,b(l.courseName),1),t("td",null,b(l.labHours),1),t("td",null,b(l.teacherName),1)]))),128))]),s(ne,{modelValue:e.pagination.number,"onUpdate:modelValue":a[15]||(a[15]=l=>e.pagination.number=l),length:e.pagination.totalPages,slot:"top"},null,8,["modelValue","length"])]),_:1},8,["modelValue","headers","items","pagination"])):z("",!0)]),_:1})]),_:1})):z("",!0),t("div",ea,[s(V,{color:"primary",onClick:k.saveSchedule},{default:m(()=>[N("保存")]),_:1},8,["onClick"])]),t("div",aa,[s(V,{color:"primary",size:"x-large",onClick:k.saveRealSchedule},{default:m(()=>[N("转换")]),_:1},8,["onClick"]),s(Me,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[17]||(a[17]=l=>e.dialogVisible=l),"max-width":"500px"},{default:m(()=>[s(j,null,{default:m(()=>[s($e,null,{default:m(()=>[N(" Confirm Synchronization ")]),_:1}),s(Fe,null,{default:m(()=>[N(" 确定转换到课程表中吗？（无法修改） ")]),_:1}),s(He,null,{default:m(()=>[s(V,{color:"primary",onClick:k.syncToSchedule},{default:m(()=>[N("确定")]),_:1},8,["onClick"]),s(V,{color:"error",onClick:k.cancelSync},{default:m(()=>[N("再考虑考虑")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])}const da=ie(Qe,[["render",la],["__scopeId","data-v-e313ffeb"]]);export{da as default};
